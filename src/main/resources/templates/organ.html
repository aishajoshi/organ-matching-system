<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{header :: header-css}"></head>
<body>
<div th:replace="~{header :: header}"></div>
<div class="container">
    <h2 th:text="${editMode} ? 'Edit Organ Details' : 'Register an Organ'"></h2>

    <form th:action="${editMode} ? @{/organ/update} : @{/organ/save}" th:object="${organ}" method="post">
        <input type="hidden" th:if="${editMode}" th:field="*{organId}" />

        <!-- Donor ID input -->
        <div>
            <label for="donorId">Donor ID:</label>
            <input type="text" id="donorId" th:field="*{donorId}" placeholder="Enter Donor ID" required />
        </div>

        <!-- Organ Name -->
        <div>
            <label for="organName">Organ Name:</label>
            <input type="text" id="organName" th:field="*{organName}" required />
        </div>

        <!-- Organ Type (Only Kidney, Liver, Heart) -->
        <div>
            <label for="organType">Organ Type:</label>
            <select id="organType" th:field="*{organType}" required>
                <option value="">--Select Type--</option>
                <option th:value="KIDNEY">Kidney</option>
                <option th:value="LIVER">Liver</option>
                <option th:value="HEART">Heart</option>
            </select>
        </div>

        <!-- Blood Group -->
        <div>
            <label for="bloodGroup">Blood Group:</label>
            <select id="bloodGroup" th:field="*{bloodGroup}" required>
                <option value="">--Select Blood Group--</option>
                <option th:value="A_POSITIVE">A+</option>
                <option th:value="A-">A-</option>
                <option th:value="B_POS">B+</option>
                <option th:value="B_NEG">B-</option>
                <option th:value="AB_POS">AB+</option>
                <option th:value="AB_NEG">AB-</option>
                <option th:value="O_POS">O+</option>
                <option th:value="O_NEG">O-</option>
            </select>
        </div>

        <!-- Organ Status -->
        <div>
            <label for="status">Organ Status:</label>
            <select id="status" th:field="*{status}" required>
                <option value="">--Select Status--</option>
                <option th:value="AVAILABLE">Available</option>
                <option th:value="MATCHED">Matched</option>
                <option th:value="TRANSPLANTED">Transplanted</option>
            </select>
        </div>

        <!-- Submit -->
        <div>
            <button type="submit" th:text="${editMode} ? 'Update Organ' : 'Register Organ'"></button>
        </div>
    </form>

    <!-- Add Multiple Organs for Donor -->
    <div style="margin-top:2rem;">
        <h3>Add Multiple Organs for a Donor</h3>
        <form th:action="@{/organ/saveMultiple}" method="post">
            <div>
                <label for="multiDonorId">Donor ID:</label>
                <input type="text" id="multiDonorId" name="donorId" required />
            </div>
            <div id="organsContainer">
                <div class="organ-entry">
                    <input type="text" name="organNames" placeholder="Organ Name" required />
                    <select name="organTypes" required>
                        <option value="">--Type--</option>
                        <option value="KIDNEY">Kidney</option>
                        <option value="LIVER">Liver</option>
                        <option value="HEART">Heart</option>
                    </select>
                    <select name="bloodGroups" required>
                        <option value="">--Blood Group--</option>
                        <option value="A_POSITIVE">A+</option>
                        <option value="A-">A-</option>
                        <option value="B_POS">B+</option>
                        <option value="B_NEG">B-</option>
                        <option value="AB_POS">AB+</option>
                        <option value="AB_NEG">AB-</option>
                        <option value="O_POS">O+</option>
                        <option value="O_NEG">O-</option>
                    </select>
                </div>
            </div>
            <button type="button" onclick="addOrganEntry()">Add Another Organ</button>
            <button type="submit">Register Organs</button>
        </form>
    </div>

    <!-- Assign Existing Organ to Recipient -->
    <div style="margin-top:2rem;">
        <h3>Assign Existing Organ to Recipient</h3>
        <form th:action="@{/organ/assign}" method="post">
            <div>
                <label for="assignOrganId">Organ ID:</label>
                <input type="text" id="assignOrganId" name="organId" required />
            </div>
            <div>
                <label for="assignRecipientId">Recipient ID:</label>
                <input type="text" id="assignRecipientId" name="recipientId" required />
            </div>
            <button type="submit">Assign Organ</button>
        </form>
    </div>

    <!-- Add Multiple Organs for Recipient -->
    <div style="margin-top:2rem;">
        <h3>Add Multiple Organs for a Recipient</h3>
        <form th:action="@{/organ/saveMultipleForRecipient}" method="post">
            <div>
                <label for="multiRecipientId">Recipient ID:</label>
                <input type="text" id="multiRecipientId" name="recipientId" required />
            </div>
            <div id="recipientOrgansContainer">
                <div class="organ-entry">
                    <input type="text" name="organNames" placeholder="Organ Name" required />
                    <select name="organTypes" required>
                        <option value="">--Type--</option>
                        <option value="KIDNEY">Kidney</option>
                        <option value="LIVER">Liver</option>
                        <option value="HEART">Heart</option>
                    </select>
                    <select name="bloodGroups" required>
                        <option value="">--Blood Group--</option>
                        <option value="A_POSITIVE">A+</option>
                        <option value="A-">A-</option>
                        <option value="B_POS">B+</option>
                        <option value="B_NEG">B-</option>
                        <option value="AB_POS">AB+</option>
                        <option value="AB_NEG">AB-</option>
                        <option value="O_POS">O+</option>
                        <option value="O_NEG">O-</option>
                    </select>
                </div>
            </div>
            <button type="button" onclick="addRecipientOrganEntry()">Add Another Organ</button>
            <button type="submit">Register Organs</button>
        </form>
    </div>

    <script>
        function addOrganEntry() {
            const container = document.getElementById('organsContainer');
            const entry = document.createElement('div');
            entry.className = 'organ-entry';
            entry.innerHTML = `<input type="text" name="organNames" placeholder="Organ Name" required />
                <select name="organTypes" required>
                    <option value="">--Type--</option>
                    <option value="KIDNEY">Kidney</option>
                    <option value="LIVER">Liver</option>
                    <option value="HEART">Heart</option>
                </select>
                <select name="bloodGroups" required>
                    <option value="">--Blood Group--</option>
                    <option value="A_POSITIVE">A+</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B_NEG">B-</option>
                    <option value="AB_POS">AB+</option>
                    <option value="AB_NEG">AB-</option>
                    <option value="O_POS">O+</option>
                    <option value="O_NEG">O-</option>
                </select>`;
            container.appendChild(entry);
        }
        function addRecipientOrganEntry() {
            const container = document.getElementById('recipientOrgansContainer');
            const entry = document.createElement('div');
            entry.className = 'organ-entry';
            entry.innerHTML = `<input type="text" name="organNames" placeholder="Organ Name" required />
                <select name="organTypes" required>
                    <option value="">--Type--</option>
                    <option value="KIDNEY">Kidney</option>
                    <option value="LIVER">Liver</option>
                    <option value="HEART">Heart</option>
                </select>
                <select name="bloodGroups" required>
                    <option value="">--Blood Group--</option>
                    <option value="A_POSITIVE">A+</option>
                    <option value="A-">A-</option>
                    <option value="B_POS">B+</option>
                    <option value="B_NEG">B-</option>
                    <option value="AB_POS">AB+</option>
                    <option value="AB_NEG">AB-</option>
                    <option value="O_POS">O+</option>
                    <option value="O_NEG">O-</option>
                </select>`;
            container.appendChild(entry);
        }
    </script>

    <!-- Messages -->
    <div th:if="${param.success}">
        <p class="success">Organ registered successfully!</p>
    </div>
    <div th:if="${param.updated}">
        <p class="success">Organ updated successfully!</p>
    </div>

    <a th:href="@{/organ/list}">Back to Organ List</a>
</div>
<div th:replace="~{footer :: footer}"></div>
</body>
</html>
